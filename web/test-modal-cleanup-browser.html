<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡æ€æ¡†æ¸…ç†åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f7fa;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 12px 0 rgba(0,0,0,0.1);
        }
        .test-results {
            margin-top: 30px;
        }
        .test-item {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #dddee1;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .test-item.running {
            border-color: #409eff;
            background: #ecf5ff;
        }
        .test-item.passed {
            border-color: #67c23a;
            background: #f0f9eb;
        }
        .test-item.failed {
            border-color: #f56c6c;
            background: #fef0f0;
        }
        .test-status {
            font-size: 14px;
            font-weight: bold;
        }
        button {
            background: #409eff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #66b1ff;
        }
        .summary {
            margin-top: 30px;
            padding: 20px;
            background: #f4f4f5;
            border-radius: 4px;
        }
        .error-details {
            color: #f56c6c;
            font-family: monospace;
            font-size: 12px;
            margin-top: 10px;
            padding: 10px;
            background: white;
            border: 1px solid #f56c6c;
            border-radius: 4px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>æ¨¡æ€æ¡†æ¸…ç†åŠŸèƒ½æµ‹è¯•</h1>
        <p>æµ‹è¯•æ•°æ®å­—å…¸åˆ é™¤ç¡®è®¤æ¨¡æ€æ¡†çš„æ¸…ç†åŠŸèƒ½</p>
        <button onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
        <div id="testResults" class="test-results"></div>
        <div id="summary" class="summary" style="display: none;"></div>
    </div>

    <script>
        // æµ‹è¯•ç»“æœå¯¹è±¡
        const testResults = {
            total: 0,
            passed: 0,
            failed: 0,
            errors: []
        };

        // æµ‹è¯•è¾…åŠ©å‡½æ•°
        async function test(name, fn) {
            testResults.total++;
            const container = document.getElementById('testResults');
            const testItem = document.createElement('div');
            testItem.className = 'test-item running';
            testItem.innerHTML = `<span>ğŸ§ª ${name}</span><span class="test-status">è¿è¡Œä¸­...</span>`;
            container.appendChild(testItem);

            try {
                await fn(testItem);
                testResults.passed++;
                testItem.className = 'test-item passed';
                testItem.innerHTML = `<span>âœ… ${name}</span><span class="test-status">é€šè¿‡</span>`;
            } catch (error) {
                testResults.failed++;
                testResults.errors.push({ test: name, error: error.message, stack: error.stack });
                testItem.className = 'test-item failed';
                testItem.innerHTML = `<span>âŒ ${name}</span><span class="test-status">å¤±è´¥</span>`;
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-details';
                errorDiv.textContent = error.message + '\n' + error.stack;
                testItem.appendChild(errorDiv);
            }
        }

        // æ–­è¨€å‡½æ•°
        function assert(condition, message) {
            if (!condition) {
                throw new Error(message || 'æ–­è¨€å¤±è´¥');
            }
        }

        // æŸ¥æ‰¾æ¨¡æ€æ¡†ç›¸å…³å…ƒç´ 
        function findModalElements() {
            return {
                root: document.querySelector('.ant-modal-confirm-centered'),
                wrap: document.querySelector('.ant-modal-confirm-centered .ant-modal-wrap'),
                mask: document.querySelector('.ant-modal-confirm-centered .ant-modal-mask'),
                closeBtn: document.querySelector('.ant-modal-confirm-centered .ant-modal-close'),
                okBtn: document.querySelector('.ant-modal-confirm-centered .ant-modal-confirm-btns .ant-btn-primary'),
                cancelBtn: document.querySelector('.ant-modal-confirm-centered .ant-modal-confirm-btns .ant-btn:not(.ant-btn-primary)')
            };
        }

        // ç»Ÿè®¡æ‰€æœ‰æ¨¡æ€æ¡†å…ƒç´ 
        function countAllModalElements() {
            const elements = document.querySelectorAll('.ant-modal-confirm-centered, .ant-modal-confirm-centered .ant-modal-wrap, .ant-modal-confirm-centered .ant-modal-mask');
            return elements.length;
        }

        // æ¨¡æ‹Ÿåˆ›å»ºæ¨¡æ€æ¡†
        function simulateModalCreation() {
            const modalContainer = document.createElement('div');
            const modalHTML = `
                <div class="ant-modal-root ant-modal-confirm-centered">
                    <div class="ant-modal-mask" style="background-color: rgba(0, 0, 0, 0.45);"></div>
                    <div class="ant-modal-wrap" tabindex="-1">
                        <div class="ant-modal" style="width: 520px; transform-origin: 50% 50%;">
                            <div class="ant-modal-content">
                                <button type="button" class="ant-modal-close" aria-label="Close">
                                    <span class="ant-modal-close-x">
                                        <span role="img" aria-label="close" class="anticon anticon-close ant-modal-close-icon">
                                            <svg viewBox="64 64 896 896" focusable="false" class="" data-icon="close" width="1em" height="1em" fill="currentColor" aria-hidden="true">
                                                <path d="M563.8 512l262.5-312.9c4.4-5.2.7-13.1-6.1-13.1h-79.8c-4.7 0-9.2 2.1-12.3 5.7L511.6 449.8 295.1 191.7c-3-3.6-7.5-5.7-12.3-5.7H203c-6.8 0-10.5 7.9-6.1 13.1L459.4 512 196.9 824.9A7.95 7.95 0 0 0 203 838h79.8c4.7 0 9.2-2.1 12.3-5.7l216.5-258.1 216.5 258.1c3 3.6 7.5 5.7 12.3 5.7h79.8c6.8 0 10.5-7.9 6.1-13.1L563.8 512z"></path>
                                            </svg>
                                        </span>
                                    </span>
                                </button>
                                <div class="ant-modal-header">
                                    <div class="ant-modal-title" id="rcDialogTitle0">
                                        <div class="ant-modal-confirm-title">
                                            <span role="img" aria-label="exclamation-circle" class="anticon anticon-exclamation-circle">
                                                <svg viewBox="64 64 896 896" focusable="false" class="" data-icon="exclamation-circle" width="1em" height="1em" fill="#faad14" aria-hidden="true">
                                                    <path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm-32 232c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V296zm32 440a48.01 48.01 0 0 1 0-96 48.01 48.01 0 0 1 0 96z"></path>
                                                </svg>
                                            </span>
                                            åˆ é™¤ç¡®è®¤
                                        </div>
                                    </div>
                                </div>
                                <div class="ant-modal-body">
                                    <div class="ant-modal-confirm-body-wrapper">
                                        <div class="ant-modal-confirm-body">
                                            <span class="ant-modal-confirm-title">åˆ é™¤ç¡®è®¤</span>
                                            <div class="ant-modal-confirm-content">ç¡®å®šåˆ é™¤é€‰ä¸­çš„æ•°æ®å—ï¼Ÿ</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="ant-modal-footer">
                                    <div class="ant-modal-confirm-btns">
                                        <button type="button" class="ant-btn ant-btn-default ant-btn-sm">
                                            <span>å–æ¶ˆ</span>
                                        </button>
                                        <button type="button" class="ant-btn ant-btn-primary ant-btn-sm">
                                            <span>ç¡®å®š</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div tabindex="0" style="width: 0px; height: 0px; overflow: hidden; outline: none;"></div>
                        </div>
                    </div>
                </div>
            `;
            modalContainer.innerHTML = modalHTML;
            modalContainer.style.display = 'none';
            document.body.appendChild(modalContainer);
            return modalContainer;
        }

        // æ¨¡æ€æ¡†æ¸…ç†å‡½æ•°ï¼ˆä»ModelConfirmButton.vueæå–ï¼‰
        function cleanupModal() {
            const elements = document.querySelectorAll('.ant-modal-confirm-centered');
            elements.forEach(element => {
                element.style.display = 'none';
                element.remove();
            });
        }

        // æµ‹è¯•æ¸…ç†å‡½æ•°
        function testCleanup() {
            const container = simulateModalCreation();

            // éªŒè¯æ¨¡æ€æ¡†å·²åˆ›å»º
            assert(countAllModalElements() > 0, 'æ¨¡æ€æ¡†åº”è¯¥å·²åˆ›å»º');

            // æ‰§è¡Œæ¸…ç†
            cleanupModal();

            // éªŒè¯æ¨¡æ€æ¡†å·²æ¸…ç†
            assert(countAllModalElements() === 0, 'æ¨¡æ€æ¡†åº”è¯¥å·²è¢«æ¸…ç†');

            // æ¸…ç†æµ‹è¯•å®¹å™¨
            if (container && container.parentNode) {
                container.remove();
            }
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            // é‡ç½®ç»“æœ
            testResults.total = 0;
            testResults.passed = 0;
            testResults.failed = 0;
            testResults.errors = [];

            document.getElementById('testResults').innerHTML = '';
            document.getElementById('summary').style.display = 'none';

            console.log('=== å¼€å§‹è¿è¡Œæµ‹è¯•å¥—ä»¶ ===\n');

            // è¿è¡Œæµ‹è¯•
            await test('æ¨¡æ€æ¡†å…ƒç´ æŸ¥æ‰¾åŠŸèƒ½', async () => {
                const modal = simulateModalCreation();
                const elements = findModalElements();

                assert(elements.root !== null, 'åº”è¯¥æ‰¾åˆ°æ ¹å…ƒç´ ');
                assert(elements.wrap !== null, 'åº”è¯¥æ‰¾åˆ°wrapå…ƒç´ ');
                assert(elements.mask !== null, 'åº”è¯¥æ‰¾åˆ°maskå…ƒç´ ');
                assert(elements.closeBtn !== null, 'åº”è¯¥æ‰¾åˆ°å…³é—­æŒ‰é’®');
                assert(elements.okBtn !== null, 'åº”è¯¥æ‰¾åˆ°ç¡®å®šæŒ‰é’®');
                assert(elements.cancelBtn !== null, 'åº”è¯¥æ‰¾åˆ°å–æ¶ˆæŒ‰é’®');

                modal.remove();
            });

            await test('æ¨¡æ€æ¡†æ¸…ç†åŠŸèƒ½', async () => {
                testCleanup();
            });

            await test('å¤šæ¬¡æ‰“å¼€å’Œå…³é—­æ¨¡æ€æ¡†', async () => {
                for (let i = 0; i < 5; i++) {
                    testCleanup();
                }
            });

            await test('å¿«é€Ÿç‚¹å‡»å…³é—­æŒ‰é’®', async () => {
                const modal = simulateModalCreation();
                const closeBtn = document.querySelector('.ant-modal-confirm-centered .ant-modal-close');

                assert(closeBtn !== null, 'åº”è¯¥æ‰¾åˆ°å…³é—­æŒ‰é’®');

                // æ¨¡æ‹Ÿå¿«é€Ÿç‚¹å‡»
                for (let i = 0; i < 10; i++) {
                    closeBtn.click();
                }

                cleanupModal();
                assert(countAllModalElements() === 0, 'å¿«é€Ÿç‚¹å‡»åæ¨¡æ€æ¡†åº”è¯¥å·²è¢«æ¸…ç†');

                modal.remove();
            });

            await test('åŒæ—¶ç‚¹å‡»ç¡®å®šå’Œå…³é—­æŒ‰é’®', async () => {
                const modal = simulateModalCreation();
                const okBtn = document.querySelector('.ant-modal-confirm-centered .ant-modal-confirm-btns .ant-btn-primary');
                const closeBtn = document.querySelector('.ant-modal-confirm-centered .ant-modal-close');

                assert(okBtn !== null, 'åº”è¯¥æ‰¾åˆ°ç¡®å®šæŒ‰é’®');
                assert(closeBtn !== null, 'åº”è¯¥æ‰¾åˆ°å…³é—­æŒ‰é’®');

                // åŒæ—¶è§¦å‘ä¸¤ä¸ªæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶
                okBtn.click();
                closeBtn.click();

                cleanupModal();
                assert(countAllModalElements() === 0, 'åŒæ—¶ç‚¹å‡»åæ¨¡æ€æ¡†åº”è¯¥å·²è¢«æ¸…ç†');

                modal.remove();
            });

            await test('æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿåçš„æ¸…ç†', async () => {
                const modal = simulateModalCreation();

                // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
                await new Promise(resolve => setTimeout(resolve, 100));

                cleanupModal();
                assert(countAllModalElements() === 0, 'å»¶è¿Ÿåæ¨¡æ€æ¡†åº”è¯¥å·²è¢«æ¸…ç†');

                modal.remove();
            });

            await test('éªŒè¯CSSç±»åé€‰æ‹©å™¨æ­£ç¡®æ€§', async () => {
                const modal = simulateModalCreation();

                // éªŒè¯é€‰æ‹©å™¨èƒ½æ­£ç¡®æ‰¾åˆ°å…ƒç´ 
                const elements = document.querySelectorAll('.ant-modal-confirm-centered');
                assert(elements.length > 0, 'åº”è¯¥èƒ½æ‰¾åˆ°ant-modal-confirm-centeredå…ƒç´ ');

                const mask = document.querySelector('.ant-modal-confirm-centered .ant-modal-mask');
                assert(mask !== null, 'åº”è¯¥èƒ½æ‰¾åˆ°maskå…ƒç´ ');

                const wrap = document.querySelector('.ant-modal-confirm-centered .ant-modal-wrap');
                assert(wrap !== null, 'åº”è¯¥èƒ½æ‰¾åˆ°wrapå…ƒç´ ');

                modal.remove();
            });

            // æ˜¾ç¤ºæµ‹è¯•æ€»ç»“
            const summary = document.getElementById('summary');
            summary.style.display = 'block';
            summary.innerHTML = `
                <h3>æµ‹è¯•æ€»ç»“</h3>
                <p>æ€»æµ‹è¯•æ•°: ${testResults.total}</p>
                <p>é€šè¿‡: ${testResults.passed}</p>
                <p>å¤±è´¥: ${testResults.failed}</p>
                ${testResults.failed > 0 ? '<h4>å¤±è´¥çš„æµ‹è¯•:</h4>' + testResults.errors.map(e => `  - ${e.test}: ${e.error}`).join('<br>') : '<h4>âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼</h4>'}
            `;

            console.log('\n=== æµ‹è¯•æ€»ç»“ ===');
            console.log(`æ€»æµ‹è¯•æ•°: ${testResults.total}`);
            console.log(`é€šè¿‡: ${testResults.passed}`);
            console.log(`å¤±è´¥: ${testResults.failed}`);

            if (testResults.failed > 0) {
                console.log('
âŒ å¤±è´¥çš„æµ‹è¯•:');
                testResults.errors.forEach(({ test, error }) => {
                    console.log(`  - ${test}: ${error}`);
                });
            } else {
                console.log('
âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼');
            }

            console.log('\n=== æ¨¡æ€æ¡†æ¸…ç†åŠŸèƒ½æµ‹è¯•å®Œæˆ ===');
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.addEventListener('load', () => {
            console.log('æµ‹è¯•é¡µé¢å·²åŠ è½½ï¼Œç‚¹å‡»â€œè¿è¡Œæ‰€æœ‰æµ‹è¯•â€æŒ‰é’®å¼€å§‹æµ‹è¯•');
        });
    </script>
</body>
</html>