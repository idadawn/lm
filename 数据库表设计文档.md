# 检测室数据分析系统 - 数据库表设计文档

## 一、核心业务表

### 1.1 LAB_RAW_DATA（原始数据表）

**表说明**: 存储从Excel导入的原始检测数据

| 字段名 | 数据类型 | 长度 | 可空 | 默认值 | 说明 |
|--------|---------|------|------|--------|------|
| F_ID | VARCHAR | 50 | NO | - | 主键ID |
| F_TENANTID | VARCHAR | 50 | YES | NULL | 租户ID |
| F_CREATORTIME | DATETIME | - | YES | NULL | 创建时间 |
| F_CREATORUSERID | VARCHAR | 50 | YES | NULL | 创建用户ID |
| F_ENABLEDMARK | INT | - | YES | 1 | 启用标识（1-启用，0-禁用） |
| F_LastModifyTime | DATETIME | - | YES | NULL | 修改时间 |
| F_LastModifyUserId | VARCHAR | 50 | YES | NULL | 修改用户ID |
| F_DeleteMark | INT | - | YES | 0 | 删除标志（0-未删除，1-已删除） |
| F_DeleteTime | DATETIME | - | YES | NULL | 删除时间 |
| F_DeleteUserId | VARCHAR | 50 | YES | NULL | 删除用户ID |
| F_PROD_DATE | DATETIME | - | YES | NULL | 生产日期 |
| F_FURNACE_NO | VARCHAR | 100 | YES | NULL | 原始炉号（包含特性汉字） |
| F_LINE_NO | VARCHAR | 10 | YES | NULL | 产线（从炉号解析） |
| F_SHIFT | VARCHAR | 10 | YES | NULL | 班次（从炉号解析） |
| F_FURNACE_NO_PARSED | VARCHAR | 50 | YES | NULL | 炉号（从炉号解析） |
| F_COIL_NO | VARCHAR | 50 | YES | NULL | 卷号（从炉号解析） |
| F_SUBCOIL_NO | VARCHAR | 50 | YES | NULL | 分卷号（从炉号解析） |
| F_FEATURE_SUFFIX | VARCHAR | 50 | YES | NULL | 特性描述（从炉号解析，原始特性汉字） |
| F_WIDTH | DECIMAL | 18,2 | YES | NULL | 宽度 |
| F_COIL_WEIGHT | DECIMAL | 18,2 | YES | NULL | 带材重量 |
| F_PRODUCT_SPEC_ID | VARCHAR | 50 | YES | NULL | 产品规格ID |
| F_PRODUCT_SPEC_CODE | VARCHAR | 50 | YES | NULL | 产品规格代码 |
| F_PRODUCT_SPEC_NAME | VARCHAR | 100 | YES | NULL | 产品规格名称 |
| F_DETECTION_COLUMNS | VARCHAR | 100 | YES | NULL | 检测列（从产品规格中获取） |
| F_DETECTION_1 | DECIMAL | 18,2 | YES | NULL | 检测数据列1（向后兼容） |
| F_DETECTION_2 | DECIMAL | 18,2 | YES | NULL | 检测数据列2（向后兼容） |
| F_DETECTION_3 | DECIMAL | 18,2 | YES | NULL | 检测数据列3（向后兼容） |
| F_DETECTION_4 | DECIMAL | 18,2 | YES | NULL | 检测数据列4（向后兼容） |
| F_DETECTION_5 | DECIMAL | 18,2 | YES | NULL | 检测数据列5（向后兼容） |
| F_DETECTION_6 | DECIMAL | 18,2 | YES | NULL | 检测数据列6（向后兼容） |
| F_DETECTION_7 | DECIMAL | 18,2 | YES | NULL | 检测数据列7（向后兼容） |
| F_DETECTION_8 | DECIMAL | 18,2 | YES | NULL | 检测数据列8（向后兼容） |
| F_DETECTION_9 | DECIMAL | 18,2 | YES | NULL | 检测数据列9（向后兼容） |
| F_DETECTION_10 | DECIMAL | 18,2 | YES | NULL | 检测数据列10（向后兼容） |
| F_DETECTION_11 | DECIMAL | 18,2 | YES | NULL | 检测数据列11（向后兼容） |
| F_DETECTION_12 | DECIMAL | 18,2 | YES | NULL | 检测数据列12（向后兼容） |
| F_DETECTION_13 | DECIMAL | 18,2 | YES | NULL | 检测数据列13（向后兼容） |
| F_DETECTION_14 | DECIMAL | 18,2 | YES | NULL | 检测数据列14（向后兼容） |
| F_DETECTION_15 | DECIMAL | 18,2 | YES | NULL | 检测数据列15（向后兼容） |
| F_DETECTION_16 | DECIMAL | 18,2 | YES | NULL | 检测数据列16（向后兼容） |
| F_DETECTION_17 | DECIMAL | 18,2 | YES | NULL | 检测数据列17（向后兼容） |
| F_DETECTION_18 | DECIMAL | 18,2 | YES | NULL | 检测数据列18（向后兼容） |
| F_DETECTION_19 | DECIMAL | 18,2 | YES | NULL | 检测数据列19（向后兼容） |
| F_DETECTION_20 | DECIMAL | 18,2 | YES | NULL | 检测数据列20（向后兼容） |
| F_DETECTION_21 | DECIMAL | 18,2 | YES | NULL | 检测数据列21（向后兼容） |
| F_DETECTION_22 | DECIMAL | 18,2 | YES | NULL | 检测数据列22（向后兼容） |
| F_DETECTION_DATA | JSON | - | YES | NULL | 检测数据列（JSON格式，存储动态检测数据） |
| F_IS_VALID_DATA | INT | - | YES | 0 | 有效数据标识（0-非有效数据，1-有效数据） |
| F_SOURCE_FILE_ID | VARCHAR | 50 | YES | NULL | Excel源文件ID（关联文件服务） |
| F_IMPORT_SESSION_ID | VARCHAR | 50 | YES | NULL | 导入会话ID（关联导入会话） |
| F_APPEARANCE_FEATURE_IDS | JSON | - | YES | NULL | 匹配后的特性ID列表（JSON格式，数组） |
| F_IMPORT_ERROR | VARCHAR | 500 | YES | NULL | 导入错误信息 |
| F_IMPORT_STATUS | INT | - | YES | 0 | 导入状态（0-成功，1-失败） |
| F_SORTCODE | BIGINT | - | YES | NULL | 排序码 |

**索引**:
- PRIMARY KEY: `F_ID`
- INDEX: `idx_prod_date` (F_PROD_DATE)
- INDEX: `idx_furnace_no` (F_FURNACE_NO)
- INDEX: `idx_product_spec_id` (F_PRODUCT_SPEC_ID)
- INDEX: `idx_import_session_id` (F_IMPORT_SESSION_ID)
- INDEX: `idx_is_valid_data` (F_IS_VALID_DATA)
- INDEX: `idx_import_status` (F_IMPORT_STATUS)
- INDEX: `idx_tenant_id` (F_TENANTID)

---

### 1.2 LAB_INTERMEDIATE_DATA（中间数据表）

**表说明**: 存储从原始数据计算生成的中间数据

| 字段名 | 数据类型 | 长度 | 可空 | 默认值 | 说明 |
|--------|---------|------|------|--------|------|
| F_ID | VARCHAR | 50 | NO | - | 主键ID |
| F_TENANTID | VARCHAR | 50 | YES | NULL | 租户ID |
| F_CREATORTIME | DATETIME | - | YES | NULL | 创建时间 |
| F_CREATORUSERID | VARCHAR | 50 | YES | NULL | 创建用户ID |
| F_ENABLEDMARK | INT | - | YES | 1 | 启用标识（1-启用，0-禁用） |
| F_LastModifyTime | DATETIME | - | YES | NULL | 修改时间 |
| F_LastModifyUserId | VARCHAR | 50 | YES | NULL | 修改用户ID |
| F_DeleteMark | INT | - | YES | 0 | 删除标志（0-未删除，1-已删除） |
| F_DeleteTime | DATETIME | - | YES | NULL | 删除时间 |
| F_DeleteUserId | VARCHAR | 50 | YES | NULL | 删除用户ID |
| F_RAW_DATA_ID | VARCHAR | 50 | YES | NULL | 原始数据ID |
| F_DATE_MONTH | VARCHAR | 10 | YES | NULL | 日期（yyyy-MM格式，可手动修改） |
| F_PROD_DATE | DATETIME | - | YES | NULL | 生产日期（原始数据日期） |
| F_SPRAY_NO | VARCHAR | 100 | YES | NULL | 喷次（产线+班次+日期+炉号组合） |
| F_LINE_NO | VARCHAR | 10 | YES | NULL | 产线 |
| F_SHIFT | VARCHAR | 10 | YES | NULL | 班次 |
| F_FURNACE_NO_PARSED | VARCHAR | 50 | YES | NULL | 炉号（解析后的炉号数字部分） |
| F_FURNACE_NO | VARCHAR | 100 | YES | NULL | 原始炉号（去掉特性汉字后的炉号） |
| F_COIL_NO | VARCHAR | 50 | YES | NULL | 卷号 |
| F_SUBCOIL_NO | VARCHAR | 50 | YES | NULL | 分卷号 |
| F_PRODUCT_SPEC_ID | VARCHAR | 50 | YES | NULL | 产品规格ID |
| F_PRODUCT_SPEC_NAME | VARCHAR | 100 | YES | NULL | 产品规格名称 |
| F_ONE_METER_WEIGHT | DECIMAL | 18,2 | YES | NULL | 一米带材重量(g)：原始数据带材重量/产品规格长度 |
| F_FOUR_METER_WEIGHT | DECIMAL | 18,2 | YES | NULL | 四米带材重量(g) |
| F_STRIP_WIDTH | DECIMAL | 18,2 | YES | NULL | 带宽(mm) |
| F_THICKNESS_RANGE | VARCHAR | 50 | YES | NULL | 带厚范围（最小值～最大值） |
| F_THICKNESS_MIN | DECIMAL | 18,2 | YES | NULL | 带厚最小值 |
| F_THICKNESS_MAX | DECIMAL | 18,2 | YES | NULL | 带厚最大值 |
| F_THICKNESS_DIFF | DECIMAL | 18,1 | YES | NULL | 带厚极差：最大值-最小值，一位小数 |
| F_AVG_THICKNESS | DECIMAL | 18,2 | YES | NULL | 平均厚度 |
| F_DENSITY | DECIMAL | 18,2 | YES | NULL | 密度 (g/cm3) |
| F_LAMINATION_FACTOR | DECIMAL | 18,2 | YES | NULL | 叠片系数 |
| F_APPEARANCE_FEATURE | VARCHAR | 200 | YES | NULL | 外观特性（原始特性汉字） |
| F_APPEARANCE_FEATURE_IDS | JSON | - | YES | NULL | 匹配后的特性ID列表（JSON格式，数组） |
| F_BREAK_COUNT | INT | - | YES | NULL | 断头数（个） |
| F_COIL_WEIGHT_KG | DECIMAL | 18,2 | YES | NULL | 单卷重量（kg） |
| F_APPEARANCE_INSPECTOR_ID | VARCHAR | 50 | YES | NULL | 外观检验员ID |
| F_APPEARANCE_INSPECTOR_NAME | VARCHAR | 50 | YES | NULL | 外观检验员姓名 |
| F_MAGNETIC_RESULT | VARCHAR | 50 | YES | NULL | 磁性能判定 |
| F_THICKNESS_RESULT | VARCHAR | 50 | YES | NULL | 厚度判定 |
| F_LAMINATION_RESULT | VARCHAR | 50 | YES | NULL | 叠片系数判定 |
| F_MAX_THICKNESS_RAW | DECIMAL | 18,2 | YES | NULL | 最大厚度（检测列最大值） |
| F_MAX_AVG_THICKNESS | DECIMAL | 18,2 | YES | NULL | 最大平均厚度（最大值/层数） |
| F_STRIP_TYPE | DECIMAL | 18,2 | YES | NULL | 带型（中间段相对两侧段的位置判断） |
| F_SEGMENT_TYPE | VARCHAR | 20 | YES | NULL | 分段类型（前端/中端/后端） |
| F_REMARK | VARCHAR | 500 | YES | NULL | 备注 |
| F_THICKNESS_1 | DECIMAL | 18,2 | YES | NULL | 带厚1 |
| F_THICKNESS_2 | DECIMAL | 18,2 | YES | NULL | 带厚2 |
| F_THICKNESS_3 | DECIMAL | 18,2 | YES | NULL | 带厚3 |
| F_THICKNESS_4 | DECIMAL | 18,2 | YES | NULL | 带厚4 |
| F_THICKNESS_5 | DECIMAL | 18,2 | YES | NULL | 带厚5 |
| F_THICKNESS_6 | DECIMAL | 18,2 | YES | NULL | 带厚6 |
| F_THICKNESS_7 | DECIMAL | 18,2 | YES | NULL | 带厚7 |
| F_THICKNESS_8 | DECIMAL | 18,2 | YES | NULL | 带厚8 |
| F_THICKNESS_9 | DECIMAL | 18,2 | YES | NULL | 带厚9 |
| F_THICKNESS_10 | DECIMAL | 18,2 | YES | NULL | 带厚10 |
| F_THICKNESS_ABNORMAL | VARCHAR | 200 | YES | NULL | 带厚异常标记（JSON格式，标记哪些带厚需要红色标注） |
| F_LAMINATION_DIST_1 | DECIMAL | 18,2 | YES | NULL | 叠片系数分布1 |
| F_LAMINATION_DIST_2 | DECIMAL | 18,2 | YES | NULL | 叠片系数分布2 |
| F_LAMINATION_DIST_3 | DECIMAL | 18,2 | YES | NULL | 叠片系数分布3 |
| F_LAMINATION_DIST_4 | DECIMAL | 18,2 | YES | NULL | 叠片系数分布4 |
| F_LAMINATION_DIST_5 | DECIMAL | 18,2 | YES | NULL | 叠片系数分布5 |
| F_LAMINATION_DIST_6 | DECIMAL | 18,2 | YES | NULL | 叠片系数分布6 |
| F_LAMINATION_DIST_7 | DECIMAL | 18,2 | YES | NULL | 叠片系数分布7 |
| F_LAMINATION_DIST_8 | DECIMAL | 18,2 | YES | NULL | 叠片系数分布8 |
| F_LAMINATION_DIST_9 | DECIMAL | 18,2 | YES | NULL | 叠片系数分布9 |
| F_LAMINATION_DIST_10 | DECIMAL | 18,2 | YES | NULL | 叠片系数分布10 |
| F_PERF_SS_POWER | DECIMAL | 18,2 | YES | NULL | 1.35T 50Hz Ss激磁功率 |
| F_PERF_PS_LOSS | DECIMAL | 18,2 | YES | NULL | 1.35T 50Hz Ps铁损 |
| F_PERF_HC | DECIMAL | 18,2 | YES | NULL | 1.35T 50Hz Hc |
| F_PERF_AFTER_SS_POWER | DECIMAL | 18,2 | YES | NULL | 刻痕后性能 Ss激磁功率 |
| F_PERF_AFTER_PS_LOSS | DECIMAL | 18,2 | YES | NULL | 刻痕后性能 Ps铁损 |
| F_PERF_AFTER_HC | DECIMAL | 18,2 | YES | NULL | 刻痕后性能 Hc |
| F_PERF_EDITOR_ID | VARCHAR | 50 | YES | NULL | 性能数据编辑人ID |
| F_PERF_EDITOR_NAME | VARCHAR | 50 | YES | NULL | 性能数据编辑人姓名 |
| F_PERF_EDIT_TIME | DATETIME | - | YES | NULL | 性能数据编辑时间 |
| F_PERF_JUDGE_NAME | VARCHAR | 50 | YES | NULL | 性能判定人 |
| F_TOUGHNESS | VARCHAR | 50 | YES | NULL | 韧性 |
| F_FISH_SCALE | VARCHAR | 50 | YES | NULL | 鱼鳞纹 |
| F_MID_SI | VARCHAR | 50 | YES | NULL | 中Si |
| F_MID_B | VARCHAR | 50 | YES | NULL | 中B |
| F_LEFT_PATTERN | VARCHAR | 50 | YES | NULL | 左花纹 |
| F_MID_PATTERN | VARCHAR | 50 | YES | NULL | 中花纹 |
| F_RIGHT_PATTERN | VARCHAR | 50 | YES | NULL | 右花纹 |
| F_APPEAR_EDITOR_ID | VARCHAR | 50 | YES | NULL | 外观特性编辑人ID |
| F_APPEAR_EDITOR_NAME | VARCHAR | 50 | YES | NULL | 外观特性编辑人姓名 |
| F_APPEAR_EDIT_TIME | DATETIME | - | YES | NULL | 外观特性编辑时间 |
| F_APPEAR_JUDGE_NAME | VARCHAR | 50 | YES | NULL | 外观检验员 |
| F_DETECTION_COLUMNS | VARCHAR | 100 | YES | NULL | 检测列配置（从产品规格中获取） |
| F_SORTCODE | BIGINT | - | YES | NULL | 排序码 |

**索引**:
- PRIMARY KEY: `F_ID`
- INDEX: `idx_raw_data_id` (F_RAW_DATA_ID)
- INDEX: `idx_prod_date` (F_PROD_DATE)
- INDEX: `idx_furnace_no` (F_FURNACE_NO)
- INDEX: `idx_product_spec_id` (F_PRODUCT_SPEC_ID)
- INDEX: `idx_tenant_id` (F_TENANTID)

---

### 1.3 LAB_PRODUCT_SPEC（产品规格表）

**表说明**: 存储产品规格定义

| 字段名 | 数据类型 | 长度 | 可空 | 默认值 | 说明 |
|--------|---------|------|------|--------|------|
| F_ID | VARCHAR | 50 | NO | - | 主键ID |
| F_TENANTID | VARCHAR | 50 | YES | NULL | 租户ID |
| F_CREATORTIME | DATETIME | - | YES | NULL | 创建时间 |
| F_CREATORUSERID | VARCHAR | 50 | YES | NULL | 创建用户ID |
| F_ENABLEDMARK | INT | - | YES | 1 | 启用标识（1-启用，0-禁用） |
| F_LastModifyTime | DATETIME | - | YES | NULL | 修改时间 |
| F_LastModifyUserId | VARCHAR | 50 | YES | NULL | 修改用户ID |
| F_DeleteMark | INT | - | YES | 0 | 删除标志（0-未删除，1-已删除） |
| F_DeleteTime | DATETIME | - | YES | NULL | 删除时间 |
| F_DeleteUserId | VARCHAR | 50 | YES | NULL | 删除用户ID |
| F_CODE | VARCHAR | 50 | YES | NULL | 规格代码（如120/142/170/213，唯一） |
| F_NAME | VARCHAR | 100 | YES | NULL | 规格名称 |
| F_DETECTION_COLUMNS | VARCHAR | 100 | YES | NULL | 对应原始数据有效列（如 13,15,18,22） |
| F_DESCRIPTION | VARCHAR | 500 | YES | NULL | 描述 |
| F_SORTCODE | BIGINT | - | YES | NULL | 排序码 |

**索引**:
- PRIMARY KEY: `F_ID`
- UNIQUE: `F_CODE` (规格代码唯一)

---

### 1.4 LAB_APPEARANCE_FEATURE（外观特性表）

**表说明**: 存储外观特性定义

| 字段名 | 数据类型 | 长度 | 可空 | 默认值 | 说明 |
|--------|---------|------|------|--------|------|
| F_ID | VARCHAR | 50 | NO | - | 主键ID |
| F_TENANTID | VARCHAR | 50 | YES | NULL | 租户ID |
| F_CREATORTIME | DATETIME | - | YES | NULL | 创建时间 |
| F_CREATORUSERID | VARCHAR | 50 | YES | NULL | 创建用户ID |
| F_ENABLEDMARK | INT | - | YES | 1 | 启用标识（1-启用，0-禁用） |
| F_LastModifyTime | DATETIME | - | YES | NULL | 修改时间 |
| F_LastModifyUserId | VARCHAR | 50 | YES | NULL | 修改用户ID |
| F_DeleteMark | INT | - | YES | 0 | 删除标志（0-未删除，1-已删除） |
| F_DeleteTime | DATETIME | - | YES | NULL | 删除时间 |
| F_DeleteUserId | VARCHAR | 50 | YES | NULL | 删除用户ID |
| F_CATEGORY_ID | VARCHAR | 50 | NO | - | 特性大类ID（外键，关联LAB_APPEARANCE_FEATURE_CATEGORY） |
| F_NAME | VARCHAR | 100 | NO | - | 特性名称（如"脆"，全局唯一） |
| F_SEVERITY_LEVEL_ID | VARCHAR | 50 | NO | - | 特性等级ID（外键，关联LAB_APPEARANCE_FEATURE_LEVEL） |
| F_KEYWORDS | VARCHAR | 1000 | YES | NULL | 关键字列表（JSON数组，用于精确匹配） |
| F_DESCRIPTION | VARCHAR | 500 | YES | NULL | 描述 |
| F_SORTCODE | BIGINT | - | YES | NULL | 排序码 |

**索引**:
- PRIMARY KEY: `F_ID`
- UNIQUE: `F_NAME` (特性名称全局唯一)
- INDEX: `F_CATEGORY_ID` (特性大类ID索引)
- INDEX: `F_SEVERITY_LEVEL_ID` (特性等级ID索引)

---

## 二、辅助配置表

### 2.1 LAB_PRODUCT_SPEC_ATTRIBUTE（产品规格扩展属性表）

**表说明**: 存储产品规格的扩展属性（如长度、层数、密度）

| 字段名 | 数据类型 | 长度 | 可空 | 默认值 | 说明 |
|--------|---------|------|------|--------|------|
| F_ID | VARCHAR | 50 | NO | - | 主键ID |
| F_TENANTID | VARCHAR | 50 | YES | NULL | 租户ID |
| F_CREATORTIME | DATETIME | - | YES | NULL | 创建时间 |
| F_CREATORUSERID | VARCHAR | 50 | YES | NULL | 创建用户ID |
| F_LastModifyTime | DATETIME | - | YES | NULL | 修改时间 |
| F_LastModifyUserId | VARCHAR | 50 | YES | NULL | 修改用户ID |
| F_DeleteMark | INT | - | YES | 0 | 删除标志（0-未删除，1-已删除） |
| F_DeleteTime | DATETIME | - | YES | NULL | 删除时间 |
| F_DeleteUserId | VARCHAR | 50 | YES | NULL | 删除用户ID |
| F_PRODUCT_SPEC_ID | VARCHAR | 50 | NO | - | 产品规格ID（外键） |
| F_ATTRIBUTE_NAME | VARCHAR | 100 | NO | - | 属性名称（如"长度"） |
| F_ATTRIBUTE_KEY | VARCHAR | 100 | NO | - | 属性键名（如"length"，唯一） |
| F_VALUE_TYPE | VARCHAR | 20 | NO | - | 属性值类型（decimal/int/text） |
| F_ATTRIBUTE_VALUE | VARCHAR | 500 | YES | NULL | 属性值（字符串存储） |
| F_UNIT | VARCHAR | 20 | YES | NULL | 属性单位（如"m"、"mm"） |
| F_PRECISION | INT | - | YES | NULL | 精度（小数位数） |
| F_SORTCODE | BIGINT | - | YES | NULL | 排序码 |

**索引**:
- PRIMARY KEY: `F_ID`
- INDEX: `F_PRODUCT_SPEC_ID` (产品规格ID索引)

---

### 2.2 LAB_PRODUCT_SPEC_PUBLIC_ATTRIBUTE（产品规格公共属性表）

**表说明**: 存储所有产品规格共享的公共属性定义

| 字段名 | 数据类型 | 长度 | 可空 | 默认值 | 说明 |
|--------|---------|------|------|--------|------|
| F_ID | VARCHAR | 50 | NO | - | 主键ID |
| F_TENANTID | VARCHAR | 50 | YES | NULL | 租户ID |
| F_CREATORTIME | DATETIME | - | YES | NULL | 创建时间 |
| F_CREATORUSERID | VARCHAR | 50 | YES | NULL | 创建用户ID |
| F_LastModifyTime | DATETIME | - | YES | NULL | 修改时间 |
| F_LastModifyUserId | VARCHAR | 50 | YES | NULL | 修改用户ID |
| F_DeleteMark | INT | - | YES | 0 | 删除标志（0-未删除，1-已删除） |
| F_DeleteTime | DATETIME | - | YES | NULL | 删除时间 |
| F_DeleteUserId | VARCHAR | 50 | YES | NULL | 删除用户ID |
| F_ATTRIBUTE_NAME | VARCHAR | 100 | NO | - | 属性名称 |
| F_ATTRIBUTE_KEY | VARCHAR | 100 | NO | - | 属性键名（唯一） |
| F_VALUE_TYPE | VARCHAR | 20 | NO | - | 属性值类型（decimal/int/text） |
| F_DEFAULT_VALUE | VARCHAR | 500 | YES | NULL | 默认值（字符串存储） |
| F_UNIT | VARCHAR | 20 | YES | NULL | 属性单位（如"m"、"mm"） |
| F_PRECISION | INT | - | YES | NULL | 精度（小数位数） |
| F_SORTCODE | BIGINT | - | YES | NULL | 排序码 |

**索引**:
- PRIMARY KEY: `F_ID`
- UNIQUE: `F_ATTRIBUTE_KEY` (属性键名唯一)

---

### 2.3 LAB_APPEARANCE_FEATURE_CATEGORY（外观特性大类表）

**表说明**: 存储外观特性分类（支持树形结构）

| 字段名 | 数据类型 | 长度 | 可空 | 默认值 | 说明 |
|--------|---------|------|------|--------|------|
| F_ID | VARCHAR | 50 | NO | - | 主键ID |
| F_TENANTID | VARCHAR | 50 | YES | NULL | 租户ID |
| F_CREATORTIME | DATETIME | - | YES | NULL | 创建时间 |
| F_CREATORUSERID | VARCHAR | 50 | YES | NULL | 创建用户ID |
| F_ENABLEDMARK | INT | - | YES | 1 | 启用标识（1-启用，0-禁用） |
| F_LastModifyTime | DATETIME | - | YES | NULL | 修改时间 |
| F_LastModifyUserId | VARCHAR | 50 | YES | NULL | 修改用户ID |
| F_DeleteMark | INT | - | YES | 0 | 删除标志（0-未删除，1-已删除） |
| F_DeleteTime | DATETIME | - | YES | NULL | 删除时间 |
| F_DeleteUserId | VARCHAR | 50 | YES | NULL | 删除用户ID |
| F_NAME | VARCHAR | 100 | NO | - | 大类名称（唯一，同一父级下） |
| F_DESCRIPTION | VARCHAR | 500 | YES | NULL | 描述 |
| F_PARENTID | VARCHAR | 50 | YES | NULL | 父级分类ID（"-1"表示顶级分类） |
| F_ROOTID | VARCHAR | 50 | YES | NULL | 根分类ID（最顶层分类的ID） |
| F_PATH | VARCHAR | 500 | YES | NULL | 分类路径（从根到当前，逗号分隔ID） |
| F_SORTCODE | BIGINT | - | YES | NULL | 排序码 |

**索引**:
- PRIMARY KEY: `F_ID`
- INDEX: `F_PARENTID` (父级分类ID索引)
- INDEX: `F_ROOTID` (根分类ID索引)

**特性**: 支持多级分类，自动计算路径和根分类

---

### 2.4 LAB_APPEARANCE_FEATURE_LEVEL（外观特性等级表）

**表说明**: 存储外观特性等级定义（如微、轻、重）

| 字段名 | 数据类型 | 长度 | 可空 | 默认值 | 说明 |
|--------|---------|------|------|--------|------|
| F_ID | VARCHAR | 50 | NO | - | 主键ID |
| F_TENANTID | VARCHAR | 50 | YES | NULL | 租户ID |
| F_CREATORTIME | DATETIME | - | YES | NULL | 创建时间 |
| F_CREATORUSERID | VARCHAR | 50 | YES | NULL | 创建用户ID |
| F_ENABLEDMARK | INT | - | YES | 1 | 启用标识（1-启用，0-禁用） |
| F_LastModifyTime | DATETIME | - | YES | NULL | 修改时间 |
| F_LastModifyUserId | VARCHAR | 50 | YES | NULL | 修改用户ID |
| F_DeleteMark | INT | - | YES | 0 | 删除标志（0-未删除，1-已删除） |
| F_DeleteTime | DATETIME | - | YES | NULL | 删除时间 |
| F_DeleteUserId | VARCHAR | 50 | YES | NULL | 删除用户ID |
| F_NAME | VARCHAR | 50 | NO | - | 等级名称（唯一，如"微"、"轻微"、"严重"） |
| F_DESCRIPTION | VARCHAR | 200 | YES | NULL | 等级描述 |
| F_ENABLED | BOOLEAN | - | YES | TRUE | 是否启用（用于程度词识别） |
| F_ISDEFAULT | BOOLEAN | - | YES | FALSE | 是否默认（只能有一个默认等级） |
| F_SORTCODE | BIGINT | - | YES | NULL | 排序码 |

**索引**:
- PRIMARY KEY: `F_ID`
- UNIQUE: `F_NAME` (等级名称唯一)

---

## 三、导入管理表

### 3.1 lab_raw_data_import_session（导入会话表）

**表说明**: 存储分步导入的会话信息

| 字段名 | 数据类型 | 长度 | 可空 | 默认值 | 说明 |
|--------|---------|------|------|--------|------|
| F_ID | VARCHAR | 50 | NO | - | 主键ID |
| F_TENANTID | VARCHAR | 50 | YES | NULL | 租户ID |
| F_CREATORTIME | DATETIME | - | YES | NULL | 创建时间 |
| F_CREATORUSERID | VARCHAR | 50 | YES | NULL | 创建用户ID |
| F_ENABLEDMARK | INT | - | YES | 1 | 启用标识（1-启用，0-禁用） |
| F_LastModifyTime | DATETIME | - | YES | NULL | 修改时间 |
| F_LastModifyUserId | VARCHAR | 50 | YES | NULL | 修改用户ID |
| F_DeleteMark | INT | - | YES | 0 | 删除标志（0-未删除，1-已删除） |
| F_DeleteTime | DATETIME | - | YES | NULL | 删除时间 |
| F_DeleteUserId | VARCHAR | 50 | YES | NULL | 删除用户ID |
| F_FILE_NAME | VARCHAR | 200 | NO | - | 文件名 |
| F_SOURCE_FILE_ID | VARCHAR | 50 | YES | NULL | Excel源文件ID |
| F_IMPORT_STRATEGY | VARCHAR | 20 | YES | 'incremental' | 导入策略（incremental/full/overwrite/deduplicate） |
| F_CURRENT_STEP | INT | - | YES | 0 | 当前步骤（0-第一步，1-第二步，2-第三步，3-第四步） |
| F_TOTAL_ROWS | INT | - | YES | 0 | 总行数 |
| F_VALID_DATA_ROWS | INT | - | YES | 0 | 有效数据行数 |
| F_STATUS | VARCHAR | 20 | YES | 'pending' | 状态（pending/in_progress/completed/failed/cancelled） |

**索引**:
- PRIMARY KEY: `F_ID`
- INDEX: `idx_status` (F_STATUS)
- INDEX: `idx_creator` (F_CREATORUSERID)
- INDEX: `idx_tenant_id` (F_TENANTID)

---

### 3.2 lab_raw_data_import_log（导入日志表）

**表说明**: 存储每次导入的日志记录

| 字段名 | 数据类型 | 长度 | 可空 | 默认值 | 说明 |
|--------|---------|------|------|--------|------|
| F_ID | VARCHAR | 50 | NO | - | 主键ID |
| F_TENANTID | VARCHAR | 50 | YES | NULL | 租户ID |
| F_CREATORTIME | DATETIME | - | YES | NULL | 创建时间 |
| F_CREATORUSERID | VARCHAR | 50 | YES | NULL | 创建用户ID |
| F_ENABLEDMARK | INT | - | YES | 1 | 启用标识（1-启用，0-禁用） |
| F_LastModifyTime | DATETIME | - | YES | NULL | 修改时间 |
| F_LastModifyUserId | VARCHAR | 50 | YES | NULL | 修改用户ID |
| F_DeleteMark | INT | - | YES | 0 | 删除标志（0-未删除，1-已删除） |
| F_DeleteTime | DATETIME | - | YES | NULL | 删除时间 |
| F_DeleteUserId | VARCHAR | 50 | YES | NULL | 删除用户ID |
| F_FILE_NAME | VARCHAR | 200 | YES | NULL | 文件名 |
| F_TOTAL_ROWS | INT | - | YES | 0 | 总行数（Excel行数） |
| F_SUCCESS_COUNT | INT | - | YES | 0 | 成功行数 |
| F_FAIL_COUNT | INT | - | YES | 0 | 失败行数 |
| F_STATUS | VARCHAR | 20 | YES | NULL | 导入状态（success/partial/failed） |
| F_IMPORT_TIME | DATETIME | - | YES | NULL | 导入时间 |
| F_SOURCE_FILE_ID | VARCHAR | 50 | YES | NULL | Excel源文件ID（关联文件服务） |
| F_VALID_DATA_COUNT | INT | - | YES | 0 | 有效数据行数（符合炉号解析规则的有效数据行数） |
| F_LAST_ROWS_HASH | VARCHAR | 200 | YES | NULL | 最后N行数据标识（哈希值，用于增量导入校验） |
| F_LAST_ROWS_COUNT | INT | - | YES | 3 | 记录的最后行数（默认3行） |
| F_IMPORT_SESSION_ID | VARCHAR | 50 | YES | NULL | 导入会话ID（关联导入会话） |

**索引**:
- PRIMARY KEY: `F_ID`
- INDEX: `idx_tenant_id` (F_TENANTID)
- INDEX: `idx_file_name` (F_FILE_NAME)
- INDEX: `idx_import_time` (F_IMPORT_TIME)

---

## 四、学习机制表

### 4.1 LAB_APPEARANCE_FEATURE_CORRECTION（外观特性修正记录表）

**表说明**: 存储人工修正记录，用于闭环学习

| 字段名 | 数据类型 | 长度 | 可空 | 默认值 | 说明 |
|--------|---------|------|------|--------|------|
| F_ID | VARCHAR | 50 | NO | - | 主键ID |
| F_TENANTID | VARCHAR | 50 | YES | NULL | 租户ID |
| F_CREATORTIME | DATETIME | - | YES | NULL | 创建时间 |
| F_CREATORUSERID | VARCHAR | 50 | YES | NULL | 创建用户ID |
| F_ENABLEDMARK | INT | - | YES | 1 | 启用标识（1-启用，0-禁用） |
| F_LastModifyTime | DATETIME | - | YES | NULL | 修改时间 |
| F_LastModifyUserId | VARCHAR | 50 | YES | NULL | 修改用户ID |
| F_DeleteMark | INT | - | YES | 0 | 删除标志（0-未删除，1-已删除） |
| F_DeleteTime | DATETIME | - | YES | NULL | 删除时间 |
| F_DeleteUserId | VARCHAR | 50 | YES | NULL | 删除用户ID |
| F_INPUT_TEXT | VARCHAR | 500 | NO | - | 原始输入文本 |
| F_AUTO_MATCHED_FEATURE_ID | VARCHAR | 50 | YES | NULL | 自动匹配的特征ID（如果有） |
| F_CORRECTED_FEATURE_ID | VARCHAR | 50 | YES | NULL | 人工修正后的特征ID |
| F_MATCH_MODE | VARCHAR | 20 | NO | - | 匹配模式（auto/manual/create/ai_proposal） |
| F_SCENARIO | VARCHAR | 20 | NO | - | 使用场景（test/import） |
| F_REMARK | VARCHAR | 500 | YES | NULL | 备注 |
| F_STATUS | VARCHAR | 20 | YES | NULL | 状态（Pending/Confirmed/Ignored） |

**索引**:
- PRIMARY KEY: `F_ID`
- INDEX: `F_CORRECTED_FEATURE_ID` (修正后的特征ID索引)
- INDEX: `F_MATCH_MODE` (匹配模式索引)
- INDEX: `F_STATUS` (状态索引)

---

## 五、数据表关系说明

### 5.1 表关系图

```
LAB_PRODUCT_SPEC (产品规格)
  ├── LAB_PRODUCT_SPEC_ATTRIBUTE (扩展属性) [1:N]
  └── LAB_PRODUCT_SPEC_PUBLIC_ATTRIBUTE (公共属性) [N:1]

LAB_APPEARANCE_FEATURE_CATEGORY (特性大类) [树形结构]
  └── LAB_APPEARANCE_FEATURE (外观特性) [1:N]
      └── LAB_APPEARANCE_FEATURE_LEVEL (特性等级) [N:1]

LAB_RAW_DATA (原始数据)
  ├── LAB_PRODUCT_SPEC [N:1]
  ├── LAB_APPEARANCE_FEATURE [N:N] (通过JSON字段存储ID列表)
  ├── lab_raw_data_import_session [N:1]
  └── LAB_INTERMEDIATE_DATA [1:1]

LAB_INTERMEDIATE_DATA (中间数据)
  └── LAB_RAW_DATA [1:1]

LAB_APPEARANCE_FEATURE_CORRECTION (修正记录)
  └── LAB_APPEARANCE_FEATURE [N:1]
```

### 5.2 外键关系

| 主表 | 从表 | 关联字段 | 关系类型 |
|------|------|---------|---------|
| LAB_PRODUCT_SPEC | LAB_PRODUCT_SPEC_ATTRIBUTE | F_PRODUCT_SPEC_ID | 1:N |
| LAB_APPEARANCE_FEATURE_CATEGORY | LAB_APPEARANCE_FEATURE | F_CATEGORY_ID | 1:N |
| LAB_APPEARANCE_FEATURE_LEVEL | LAB_APPEARANCE_FEATURE | F_SEVERITY_LEVEL_ID | 1:N |
| LAB_RAW_DATA | LAB_INTERMEDIATE_DATA | F_RAW_DATA_ID | 1:1 |
| LAB_PRODUCT_SPEC | LAB_RAW_DATA | F_PRODUCT_SPEC_ID | 1:N |
| lab_raw_data_import_session | LAB_RAW_DATA | F_IMPORT_SESSION_ID | 1:N |
| LAB_APPEARANCE_FEATURE | LAB_APPEARANCE_FEATURE_CORRECTION | F_CORRECTED_FEATURE_ID | 1:N |

---

## 六、JSON字段格式说明

### 6.1 F_DETECTION_DATA（检测数据）
**表**: LAB_RAW_DATA  
**格式**: `{"1": 123.45, "2": 234.56, "3": 345.67, ...}`  
**说明**: 键为检测列序号（字符串），值为检测数据（数字）  
**示例**: 
```json
{
  "1": 123.45,
  "2": 234.56,
  "3": 345.67,
  "4": 456.78
}
```

### 6.2 F_APPEARANCE_FEATURE_IDS（特性ID列表）
**表**: LAB_RAW_DATA, LAB_INTERMEDIATE_DATA  
**格式**: `["feature-id-1", "feature-id-2", "feature-id-3"]`  
**说明**: 特性ID数组，一个特性汉字可以匹配多个特性（1:n关系）  
**示例**: 
```json
["appearance-feature-001", "appearance-feature-002"]
```

### 6.3 F_THICKNESS_ABNORMAL（带厚异常标记）
**表**: LAB_INTERMEDIATE_DATA  
**格式**: `["1", "3", "5"]`  
**说明**: 需要红色标注的带厚序号数组  
**示例**: 
```json
["1", "3", "5"]
```

### 6.4 F_KEYWORDS（关键词列表）
**表**: LAB_APPEARANCE_FEATURE  
**格式**: `["脆", "碎", "易断", "发脆"]`  
**说明**: 关键词JSON数组，用于精确匹配  
**示例**: 
```json
["脆", "碎", "易断"]
```

---

## 七、数据表设计特点

1. **多租户支持**: 所有表都包含`F_TENANTID`字段，支持多租户隔离
2. **软删除机制**: 所有表都包含`F_DeleteMark`字段，支持软删除
3. **JSON字段**: 使用MySQL 5.7+的JSON类型，支持动态列和复杂数据结构
4. **向后兼容**: 原始数据表保留Detection1-22字段，但建议使用JSON字段
5. **索引优化**: 关键查询字段都建立了索引，提升查询性能
6. **关联关系**: 通过外键和JSON字段实现灵活的关联关系
7. **统一基础字段**: 所有表都继承CLDEntityBase基础字段（ID、租户ID、创建时间、修改时间、删除标记等）

---

## 八、表统计汇总

| 表类型 | 表数量 | 表名 |
|--------|--------|------|
| 核心业务表 | 4 | LAB_RAW_DATA, LAB_INTERMEDIATE_DATA, LAB_PRODUCT_SPEC, LAB_APPEARANCE_FEATURE |
| 辅助配置表 | 4 | LAB_PRODUCT_SPEC_ATTRIBUTE, LAB_PRODUCT_SPEC_PUBLIC_ATTRIBUTE, LAB_APPEARANCE_FEATURE_CATEGORY, LAB_APPEARANCE_FEATURE_LEVEL |
| 导入管理表 | 2 | lab_raw_data_import_session, lab_raw_data_import_log |
| 学习机制表 | 1 | LAB_APPEARANCE_FEATURE_CORRECTION |
| **总计** | **11** | - |

---

## 九、数据库版本要求

- **数据库类型**: MySQL
- **最低版本**: MySQL 5.7+
- **字符集**: utf8mb4
- **排序规则**: utf8mb4_unicode_ci
- **存储引擎**: InnoDB

---

## 十、注意事项

1. 所有表名使用大写字母，字段名使用`F_`前缀
2. JSON字段需要MySQL 5.7+版本支持
3. 所有表都支持多租户隔离，查询时需要过滤`F_TENANTID`
4. 所有表都支持软删除，查询时需要过滤`F_DeleteMark = 0`
5. 外键关系在应用层维护，数据库层面不建立外键约束（提高灵活性）
6. 索引设计考虑了常用查询场景，可根据实际使用情况调整
